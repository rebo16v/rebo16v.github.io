<!-- Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT License. -->
<!DOCTYPE html>
<html>
<head>
    <!-- Office JavaScript API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
</head>

<body>
    <br><p>IESE Montecarlo</p><br>
    <button id="setupButton">Setup</button>
    <br><br>iterations:<input type="text" size="5" id="niter" name="niter">
    <button id="montecarloButton">Montecarlo</button>
</body>

<script>
    Office.onReady((info) => {
        if (info.host === Office.HostType.Excel) {
            document.getElementById("montecarloButton").onclick = montecarlo;
            document.getElementById("setupButton").onclick = setup;
        }
    });

    function setup() {
        Excel.run(context => {
            context.workbook.worksheets.getActiveWorksheet().getRange("A1").values = [["mean"]];
            context.workbook.worksheets.getActiveWorksheet().getRange("A2").values = [["stdev"]];
            context.workbook.worksheets.getActiveWorksheet().getRange("B3").values = [["revenues"]];
            context.workbook.worksheets.getActiveWorksheet().getRange("C3").values = [["costs"]];
            context.workbook.worksheets.getActiveWorksheet().getRange("D3").values = [["profits"]];
            return context.sync();
        });
    }

    function montecarlo() {
        Excel.run(context => {

            let n_iter = document.getElementById("niter").value

            for (let i = 0; i < n_iter; i++) {
              let row = (i+4)
              let revenues = sampleNormal(1000,200)
              let costs = sampleNormal(600,100)
              context.workbook.worksheets.getActiveWorksheet().getRange("B"+row+":D"+row).values = [[revenues, costs, (revenues-costs)]];
              // context.workbook.worksheets.getActiveWorksheet().getRange("C"+(i+4)).values = [[costs]];
              // context.workbook.worksheets.getActiveWorksheet().getRange("D"+(i+4)).values = [[(revenues-costs)]];
            }
            return context.sync();
        });
    }

    function boxMullerTransform() {
    const u1 = Math.random();
    const u2 = Math.random();
    const z0 = Math.sqrt(-2.0 * Math.log(u1)) * Math.cos(2.0 * Math.PI * u2);
    const z1 = Math.sqrt(-2.0 * Math.log(u1)) * Math.sin(2.0 * Math.PI * u2);
    return { z0, z1 };
    }

    function sampleNormal(mean, stddev) {
        const { z0, _ } = boxMullerTransform();
        return z0 * stddev + mean;
    }
</script>

</html>
